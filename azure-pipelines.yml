
jobs:
- job: Conjure
  timeoutInMinutes: 0
  strategy:
    matrix:
      Linux:
        imageName: 'ubuntu-latest'
        BIN_DIR: ${HOME}/.local/bin
        PATH_SEPARATOR: ':'
      Mac:
        imageName: 'macos-latest'
        BIN_DIR: ${HOME}/.local/bin
        PATH_SEPARATOR: ':'
      Windows:
        imageName: 'vs2017-win2016'
        BIN_DIR: 'C:\\bin'
        PATH_SEPARATOR: ';'
  pool:
    vmImage: $(imageName)
  steps:
  - bash: BIN_DIR=$(BIN_DIR) PATH=$(BIN_DIR)$(PATH_SEPARATOR)${PATH} BUILD_TESTS=true make
    displayName: "Build Conjure"
  - bash: BIN_DIR=$(BIN_DIR) PATH=$(BIN_DIR)$(PATH_SEPARATOR)${PATH} etc/build/install-minion.sh
    displayName: "Install Minion"
  - bash: BIN_DIR=$(BIN_DIR) PATH=$(BIN_DIR)$(PATH_SEPARATOR)${PATH} etc/build/install-glucose.sh
    displayName: "Install Glucose"
  - bash: BIN_DIR=$(BIN_DIR) PATH=$(BIN_DIR)$(PATH_SEPARATOR)${PATH} .stack-work/*/*/*/*/*/conjure-testing --limit-time 10 --hide-successes
    displayName: "Test"

